# ==================== 主配置文件 ====================
# 训练流程配置 - 引用模型和数据集配置

# 使用的模型（会自动加载 v2/models/{model.name}/config.yaml）
model:
  name: "flowmatching"  # 可选: srdm, flowmatching, ...
  output_range: [-1.0, 1.0]  # 模型输出范围 (SRDM预测残差)

# 使用的数据集（会自动加载 v2/datasets/{data.name}/config.yaml）
data:
  name: "sen12"  # 可选: sen12, whu, ...

  # 数据归一化配置
  normalize:
    enabled: true
    input_range: [0.0, 1.0]  # Dataset输出范围

  # 通道配置（会被数据集配置覆盖）
  channels:
    optical:
      input: 3
      use: 3
      indices: [0, 1, 2]
    sar:
      input: 3
      use: 3
      indices: [0, 1, 2]

# ==================== 混合精度配置 ====================
amp:
  enabled: true           # 是否启用自动混合精度 (AMP)
  use_bf16: true         # 是否使用 BF16 (需要 A100/A800 等 Ampere 架构)
                         # FP16 (false) - 通用，但可能需要梯度缩放
                         # BF16 (true)  - A100/A800 推荐，更稳定，无需梯度缩放
  init_scale: 65536.0     # FP16 梯度初始缩放因子 (2^16)
  growth_interval: 2000   # 梯度缩放增长间隔

# ==================== 训练配置 ====================
training:
  num_epochs: 100

  optimizer:
    type: "adamw"
    lr: 0.0001
    weight_decay: 0.01
    betas: [0.9, 0.999]

  scheduler:
    type: "cosine"
    warmup_epochs: 5
    min_lr: 0.000001

  mixed_precision:
    enabled: true

  gradient_clipping:
    enabled: true
    max_norm: 1.0

  gradient_accumulation:
    enabled: true
    steps: 2  # 累积2步，等效batch_size翻倍

# ==================== 验证配置 ====================
validation:
  enabled: true
  interval: 1
  batch_size: 4
  max_samples: 50        # 最大验证样本数

  save_results:
    enabled: true
    save_dir: "results"
    save_grid: true
    grid_cols: 4

# ==================== 输出配置 ====================
output:
  composite_range: [0.0, 1.0]  # 合成后范围 (截断后归一化)
  save_format: "uint8"         # 最终保存格式

# ==================== 设备配置 ====================
device:
  use_cuda: true
  random_seed: 42
  deterministic: false

# ==================== 日志配置 ====================
logging:
  level: "INFO"
  log_dir: "logs"
  tensorboard: true
